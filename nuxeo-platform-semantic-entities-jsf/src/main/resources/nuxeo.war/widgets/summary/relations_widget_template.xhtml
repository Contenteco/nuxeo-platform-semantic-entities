<div class="relation_block" xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:nxdir="http://nuxeo.org/nxdirectory"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:a4j="http://richfaces.org/a4j"
  xmlns:rich="http://richfaces.org/rich">
  
<!--
 TODO: Temporary hack that overrides the relations place holder
       to display the mentioned entities
 TODO: Rewrite this as a generic widget that uses parameterized
       content views (once the CMISQL-joins enabled provider is
       factorized out of the project
 -->
<a4j:outputPanel id="relatedEntitiesPanel">
<f:subview rendered="#{!empty relatedPeopleProvider.currentPage}">
  <h3 class="summaryTitle">#{messages['heading.occurrencesOfPeople']}</h3>
  <c:forEach var="entity" items="#{relatedPeopleProvider.currentPage}">
    <nxl:layout name="entity_short_summary_layout" value="#{entity}" mode="view" />
  </c:forEach>
</f:subview>

<f:subview rendered="#{!empty relatedOrganizationsProvider.currentPage}">
  <h3 class="summaryTitle">#{messages['heading.occurrencesOfOrganizations']}</h3>
  <c:forEach var="entity" items="#{relatedOrganizationsProvider.currentPage}">
    <nxl:layout name="entity_short_summary_layout" value="#{entity}" mode="view" />
  </c:forEach>
</f:subview>

<f:subview rendered="#{!empty relatedPlacesProvider.currentPage}">
  <h3 class="summaryTitle">#{messages['heading.occurrencesOfPlaces']}</h3>
  <c:forEach var="entity" items="#{relatedPlacesProvider.currentPage}">
    <nxl:layout name="entity_short_summary_layout" value="#{entity}" mode="view" />
  </c:forEach>
</f:subview>

<h3 class="summaryTitle">#{messages['heading.linkToEntity']}</h3>
<h:form>
  <h:inputText id="entitySuggestionKeywords" styleClass="dataInputText" />
  <rich:suggestionbox
    suggestionAction="#{semanticEntitiesActions.suggestEntities}" var="suggestion"
    for="entitySuggestionKeywords"
    nothingLabel="${messages['label.results.noMatchingDocument']}"
    ajaxSingle="true">
    <a4j:support event="onselect" reRender="relatedEntitiesPanel"
      action="#{semanticEntitiesActions.addNewOccurrenceRelation}"
      ajaxSingle="true">
      <f:setPropertyActionListener value="#{suggestion}"
        target="#{semanticEntitiesActions.selectedSuggestion}" />
    </a4j:support>
    <h:column>
      #{entity.title} (#{entity.type})
    </h:column>
  </rich:suggestionbox>
</h:form>
</a4j:outputPanel>
</div>
