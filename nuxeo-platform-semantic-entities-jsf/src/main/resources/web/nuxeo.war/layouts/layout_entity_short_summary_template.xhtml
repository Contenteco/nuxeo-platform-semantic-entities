<f:subview
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:nxl="http://nuxeo.org/nxforms/layout"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:fn="http://java.sun.com/jsp/jstl/functions"
  xmlns:a4j="http://richfaces.org/a4j"
  id="#{layout.id}">

<div class="entityOccurrence">
<div class="entityDepictionSmallContainer">
<h:graphicImage
  url="#{nxd:fileUrl('downloadFile', value.entityModel, 'entity:depiction', value.entityModel.entity.depiction.filename)}?conversationId=#{conversation.id}"
  rendered="#{value.entityModel.hasSchema('entity') and !empty value.entityModel.entity.depiction}"
  styleClass="entityDepiction" />
<h:graphicImage
  url="/icons/#{value.entityModel.type}_100.png"
  rendered="#{value.entityModel.hasSchema('entity') and empty value.entityModel.entity.depiction}"
  styleClass="entityDepiction" />
</div>
<div style="float: right">
  <a4j:commandLink immediate="true"
    reRender="relatedEntitiesPanel"
    action="#{semanticEntitiesActions.removeOccurrenceRelation(value.documentModel.id, value.entityModel.id)}"
    rendered="#{documentManager.hasPermission(value.documentModel.ref, 'WriteProperties') and empty semanticWorkInProgressMessage}">
    <h:graphicImage value="/icons/action_delete_mini_over.png" />
  </a4j:commandLink>
</div>
<div class="entityLinkAndSummary">
<p class="entityLink">
  <nxd:restDocumentLink document="#{value.entityModel}">
    #{nxd:titleOrId(value.entityModel)}
  </nxd:restDocumentLink>
</p>
<p class="entityShortSummary">#{semanticEntitiesActions.ellipsis(value.entityModel.entity.summary, 100)}</p>
</div>
<div style="clear: both;"></div>
</div>

<div class="entityOccurrenceTooltip">
<ui:include src="/widgets/summary/summary_current_entity_heading_widget_template.xhtml">
  <ui:param name="value" value="#{value.entityModel}"/>
</ui:include>
<h3 class="summaryTitle">#{messages['heading.mentionsInCurrentDocument']}</h3>
<div class="entityMentions">
<ui:repeat value="#{value.occurrences}" var="occInfo">
 <p><h:outputText value="#{occInfo.prefixContext}"/>
     <strong><h:outputText value=" #{occInfo.mention} "/></strong>
     <h:outputText value="#{occInfo.suffixContext}"/></p>
</ui:repeat>
</div>
</div>

</f:subview>
